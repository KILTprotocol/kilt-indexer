# KILT Indexer

This project builds a customized database with information from the **[KILT Blockchain](https://www.kilt.io/)** , leveraging the robust capabilities of [SubQuery](https://subquery.network) as its backbone.
We tailor the generic framework provided by SubQuery for **collecting, processing, and storing data from chain node interaction**s.
The processed data is made available for customers to query via a website or HTTP requests.

The majority of the information collected focuses on **Identity solutions** rather than transactions.
This includes data related to [decentralized identifiers (DIDs)](https://docs.kilt.io/docs/concepts/did) and [verifiable credentials (VCs)](https://docs.kilt.io/docs/concepts/credentials/overview).

You can visit our deployed websites to query information.
It is also possible to run the indexer locally, allowing you to customize it to your needs.

## Deployed Versions

You can interact with our public GraphQL Servers via the Playgrounds deployed under following links:

* To query data from the **KILT production Blockchain**, aliased ***Spiritnet***, visit: https://indexer.kilt.io/
* To query data from the **KILT development Blockchain**, aliased ***Peregrine***, visit: https://dev-indexer.kilt.io/

# Getting started

## Prerequisites

Make sure you installed these requiered software before running this project: 

- [Node.js](https://nodejs.org/en/download/prebuilt-installer)
- [Yarn](https://yarnpkg.com/getting-started/install) 
- [PostgreSQL](https://www.postgresql.org/download/)
- [Docker](https://docs.docker.com/engine/install/)

## Installation

After [cloning the repository](https://docs.github.com/en/repositories/creating-and-managing-repositories/cloning-a-repository), to install all required modules, run:

- `yarn install`.

## Environment Variables

**You actually do not need to define any environment variables to run this project.**

There are default values for all of the environment variables. 
Nevertheless, you can use other values by assigning them inside the `.env`-file.

On the root directory of this repository, there is an `.env.example`-file that list how your variables should be named and what is their use.
The `.env`-file should be added to the same level (directory) where `.env.example`-file is found.

## Run the Project

*First make sure your docker daemon is running.*

The simplest way to run your project is by running `yarn dev` or `npm run-script dev`. 
This command sequentially executes three steps in a row.
Each of these steps can also be executed independently using the following commands:

1. `yarn codegen` 
	*  Generates types from the GraphQL schema definition and saves them in the `/src/types` directory.
	*  This must be done after each change to the `schema.graphql` file.
2. `yarn build` 
	* 	Builds and packages the SubQuery project into the `/dist` directory
3. `yarn start:docker`
	* 	It's an alias to `docker-compose pull && docker-compose up`.
	*  **Fetches and runs** three Docker containers: an **indexer**, a **PostgeSQL DataBase**, and a **query service**.
	*  The `docker-compose.yml` file manages this Docker Compose application, orchestrating the various containers needed for the project.
		It specifies wich images to pull and configures how to (re)start the services. 
	*  This [requires](#Prerequisites) Docker to be running locally.


You can observe the three services start (it may take a few minutes on your first start). Once all are running, you can head to http://localhost:3000 on your browser and you should see a [GraphQL Playground](https://academy.subquery.network/indexer/run_publish/query/graphql.html) showing with the schemas ready to query.

_If you change `schema.graphql`, `project.ts` or `mappingHandlers.ts` all **autogenerated files** during `yarn dev` **will be overwritten, with the big exception of the database** inside `.data/`._
If you make incompatible changes to any of those files, make sure you delete `.data/` before running `yarn dev` again.
After making changes to `schema.graphql` you definitely need to renew your database.

Additionally, you can run `yarn slash` to delete all autogenerated files at once, including the database.



# Editing your Indexer

*We recommend you to fork this repository to your personal 'git' before doing any changes.*
*We would love to see any improvemet suggestions comming from the community in the form of Pull Requests.* 

On top of this working SubQuery project, you can add customizations it by changing the following files:

- The project manifest `project.yaml`:
	- This defines the key project configuration and mapping handler filters.
	- `project.yaml` is autogenerated from `project.ts` wich consumes the environment variables. 
- The GraphQL Schema `schema.graphql`:
	- That defines the shape of the resulting data being indexed.
	- It defines the data models for the database.
- The Mapping directory `src/mappings/`:
	- Contains typescript functions that handle transformation logic from chain information to database entries.
	- Defines the mapping handlers listed on the project manifest.



